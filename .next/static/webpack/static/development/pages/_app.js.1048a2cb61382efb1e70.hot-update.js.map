{"version":3,"file":"static/webpack/static/development/pages/_app.js.1048a2cb61382efb1e70.hot-update.js","sources":["webpack:///./with-redux.js"],"sourcesContent":["import React from 'react'\nimport createStore from './store'\n\n\nconst isServer = typeof window === 'undefined'\nconst __NEXT_REDUX_STORE__ = '__NEXT_REDUX_STORE__'\n\nconst getOrCreateStore = (initialState) => {\n  if (isServer) {\n    return createStore(initialState)\n  }\n\n  if (!window[__NEXT_REDUX_STORE__]) {\n    window[__NEXT_REDUX_STORE__] = createStore(initialState)\n  }\n\n  return window[__NEXT_REDUX_STORE__]\n}\nexport default MyApp => {\n\n  class WithReduxApp extends React.Component {\n    static async getInitialProps (ctx) {\n      console.log('WithReduxApp getInitialProps::::')\n      const reduxStore = getOrCreateStore()\n      ctx.reduxStore = reduxStore\n      let appProps = {}\n      if (typeof MyApp.getInitialProps === 'function') {\n        appProps = await MyApp.getInitialProps(ctx)\n        console.log('appProps', appProps)\n      }\n  \n      return {\n        ...appProps,\n        initialReduxState: reduxStore.getState() // 脱水,在此是不能返回reduxStore，因为这里return的内容最终会被拍平，放在html的script标签内，客户端代码可以通过props获取到\n      }\n    }\n    \n    constructor (props) {\n      console.log('WithReduxApp constructor::::initialReduxState', props.initialReduxState)\n      super(props)\n      this.reduxStore = getOrCreateStore(props.initialReduxState)\n    }\n\n    render () {\n      const { Component, pageProps, ...rest } = this.props\n      if (pageProps) {\n        pageProps.test = '123'\n      }\n  \n      return <MyApp\n        Component={Component}\n        pageProps={pageProps}\n        {...rest}\n        reduxStore={this.reduxStore} // 注入\n      />\n    }\n  }\n\n  return WithReduxApp\n}"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AACA;AACA;AACA;AACA;AARA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AACA;AADA;AASA;AACA;AACA;AAXA;AAAA;AAeA;AACA;AAhBA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AAkBA;AAAA;AACA;AADA;AACA;AAAA;AACA;AACA;AAHA;AAIA;AACA;AAxBA;AAAA;AAAA;AAyBA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AAJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAMA;AArCA;AACA;AADA;AAAA;AACA;AAuCA;AACA;;;;A","sourceRoot":""}